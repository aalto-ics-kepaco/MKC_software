

function [grad] = gmvt_inter(A,K,S,m,para,Obs)

grad=zeros(size(A,1),size(A,2));
eps=1E-10;
M=size(K,3); 
N=size(K,2);
  
for l =1:1:M
temp(l).D=A(:,:,l)*K(:,:,l);
temp(l).hatk=temp(l).D*A(:,:,l)';
end

temp(m).B=K(:,:,m)-temp(m).hatk;
temp(m).E=temp(m).B(:,Obs(m).id)*temp(m).D(Obs(m).id,:);

for l=1:1:M
temp(l).C=zeros(N,N) ;
for l2=1:1:M
if l2==l
temp(l).C =temp(l).C+temp(l).hatk;
else
temp(l).C=temp(l).C-S(l,l2)*temp(l2).hatk;
end
end
end

% grad for A of m th view only 

grad = grad - 4*para.c1*temp(m).E/(M*length(Obs(m).id)^2); % for loss function

% relevence part

part= zeros(size(A,1),size(A,2));
for l =1:1:M
if l==m
   part=part+temp(m).C;
else
part=part-S(l,m)*temp(l).C;
end
end
grad=grad+4*para.c2*(part*temp(m).D)/(M*N);

clear temp part;

    return;     
end


































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































